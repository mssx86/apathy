# > 1
export      CC="x86_64-apathy-linux-musl-gcc"
export     CXX="x86_64-apathy-linux-musl-g++"
export      LD="ld.bfd"
export      AR="x86_64-apathy-linux-musl-gcc-ar"
export      AS="as"
export      NM="x86_64-apathy-linux-musl-gcc-nm"
export   STRIP="strip"
export  RANLIB="x86_64-apathy-linux-musl-gcc-ranlib"
export OBJCOPY="objcopy"
export OBJDUMP="objdump"
export OBJSIZE="size"
export READELF="readelf"

         CFLAGS="-DGLX_X86_READONLY_TEXT -w -pipe -O3 -mtune=native -march=native -fstack-protector-strong -fcommon"
export   CFLAGS="${CFLAGS} -fgraphite-identity -floop-nest-optimize -ftree-vectorize -flto -fuse-linker-plugin -fno-fat-lto-objects"
export CXXFLAGS="${CFLAGS}"
export  LDFLAGS="${CFLAGS} -Wl,--as-needed -Wl,--gc-sections -Wl,-O2"

# > 2
sed -i "/pre_args += '-DUSE_ELF_TLS'/d" meson.build

# > 3
mkdir build
cd    build

meson \
 --buildtype=release \
 --prefix=/usr       \
\
 -Ddri3=true         \
 -Dzstd=true         \
 -Dllvm=false        \
 -Dplatforms=x11,drm \
 -Dvulkan-drivers=   \
 -Dgallium-drivers=  \
 -Ddri-drivers=i965  \
..

# > 4
/bin/busybox time samu -j2
